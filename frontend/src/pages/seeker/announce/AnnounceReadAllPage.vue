<template>
  <div class="body-arp">
    <SeekerHeaderComponent></SeekerHeaderComponent>
    <section class="main-content">
      <h2>ì±„ìš©</h2>
      <div class="filter-section">
        <!-- ê¸°ì—…í˜•íƒœ í•„í„° -->
        <div class="filter-item" data-filter="ê¸°ì—…í˜•íƒœ">
          <button class="dropdown-btn" @click="toggleDropdown('ê¸°ì—…í˜•íƒœ')">ê¸°ì—…í˜•íƒœ</button>
          <div class="filter-dropdown" v-show="dropdownOpen['ê¸°ì—…í˜•íƒœ']">
            <label><input type="checkbox" value="ëŒ€ê¸°ì—…" @change="updateFilters('ê¸°ì—…í˜•íƒœ', 'ëŒ€ê¸°ì—…')" /> ëŒ€ê¸°ì—…</label>
            <label><input type="checkbox" value="ì¤‘ì†Œê¸°ì—…" @change="updateFilters('ê¸°ì—…í˜•íƒœ', 'ì¤‘ì†Œê¸°ì—…')" /> ì¤‘ì†Œê¸°ì—…</label>
            <label><input type="checkbox" value="ê³µê³µê¸°ê´€/ê³µê¸°ì—…" @change="updateFilters('ê¸°ì—…í˜•íƒœ', 'ê³µê³µê¸°ê´€/ê³µê¸°ì—…')" />
              ê³µê³µê¸°ê´€/ê³µê¸°ì—…</label>
            <label><input type="checkbox" value="ì™¸êµ­ê³„ê¸°ì—…" @change="updateFilters('ê¸°ì—…í˜•íƒœ', 'ì™¸êµ­ê³„ê¸°ì—…')" /> ì™¸êµ­ê³„ê¸°ì—…</label>
            <label><input type="checkbox" value="ì¤‘ê²¬ê¸°ì—…" @change="updateFilters('ê¸°ì—…í˜•íƒœ', 'ì¤‘ê²¬ê¸°ì—…')" /> ì¤‘ê²¬ê¸°ì—…</label>
            <label><input type="checkbox" value="ë¹„ì˜ë¦¬ë‹¨ì²´/í˜‘íšŒ/ì¬ë‹¨" @change="updateFilters('ê¸°ì—…í˜•íƒœ', 'ë¹„ì˜ë¦¬ë‹¨ì²´/í˜‘íšŒ/ì¬ë‹¨')" />
              ë¹„ì˜ë¦¬ë‹¨ì²´/í˜‘íšŒ/ì¬ë‹¨</label>
            <label><input type="checkbox" value="ë²¤ì²˜ê¸°ì—…" @change="updateFilters('ê¸°ì—…í˜•íƒœ', 'ë²¤ì²˜ê¸°ì—…')" /> ë²¤ì²˜ê¸°ì—…</label>
          </div>
        </div>
        <!-- ì±„ìš©í˜•íƒœ í•„í„° -->
        <div class="filter-item" data-filter="ì±„ìš©í˜•íƒœ">
          <button class="dropdown-btn" @click="toggleDropdown('ì±„ìš©í˜•íƒœ')">ì±„ìš©í˜•íƒœ</button>
          <div class="filter-dropdown" v-show="dropdownOpen['ì±„ìš©í˜•íƒœ']">
            <label><input type="checkbox" value="ì‹ ì…" @change="updateFilters('ì±„ìš©í˜•íƒœ', 'ì‹ ì…')" /> ì‹ ì…</label>
            <label><input type="checkbox" value="ê²½ë ¥" @change="updateFilters('ì±„ìš©í˜•íƒœ', 'ê²½ë ¥')" /> ê²½ë ¥</label>
          </div>
        </div>
        <!-- ëª¨ì§‘ì§ë¬´ í•„í„° -->
        <div class="filter-item" data-filter="ëª¨ì§‘ì§ë¬´">
          <button class="dropdown-btn" @click="toggleDropdown('ëª¨ì§‘ì§ë¬´')">ëª¨ì§‘ì§ë¬´</button>
          <div class="filter-dropdown" v-show="dropdownOpen['ëª¨ì§‘ì§ë¬´']">
            <label><input type="checkbox" value="ì˜ì—…/ê³ ê°ìƒë‹´" @change="updateFilters('ëª¨ì§‘ì§ë¬´', 'ì˜ì—…/ê³ ê°ìƒë‹´')" /> ì˜ì—…/ê³ ê°ìƒë‹´</label>
            <label><input type="checkbox" value="ê²½ì˜/ì‚¬ë¬´" @change="updateFilters('ëª¨ì§‘ì§ë¬´', 'ê²½ì˜/ì‚¬ë¬´')" /> ê²½ì˜/ì‚¬ë¬´</label>
            <label><input type="checkbox" value="ë§ˆì¼€íŒ…/ê´‘ê³ /í™ë³´" @change="updateFilters('ëª¨ì§‘ì§ë¬´', 'ë§ˆì¼€íŒ…/ê´‘ê³ /í™ë³´')" />
              ë§ˆì¼€íŒ…/ê´‘ê³ /í™ë³´</label>
            <label><input type="checkbox" value="ìƒì‚°/ì œì¡°" @change="updateFilters('ëª¨ì§‘ì§ë¬´', 'ìƒì‚°/ì œì¡°')" /> ìƒì‚°/ì œì¡°</label>
            <label><input type="checkbox" value="ì—°êµ¬ê°œë°œ/ì„¤ê³„" @change="updateFilters('ëª¨ì§‘ì§ë¬´', 'ì—°êµ¬ê°œë°œ/ì„¤ê³„')" /> ì—°êµ¬ê°œë°œ/ì„¤ê³„</label>
            <label><input type="checkbox" value="IT/ì¸í„°ë„·" @change="updateFilters('ëª¨ì§‘ì§ë¬´', 'IT/ì¸í„°ë„·')" /> IT/ì¸í„°ë„·</label>
          </div>
        </div>
        <!-- ê·¼ë¬´ì§€ì—­ í•„í„° -->
        <div class="filter-item" data-filter="ê·¼ë¬´ì§€ì—­">
          <button class="dropdown-btn" @click="toggleDropdown('ê·¼ë¬´ì§€ì—­')">ê·¼ë¬´ì§€ì—­</button>
          <div class="filter-dropdown" v-show="dropdownOpen['ê·¼ë¬´ì§€ì—­']">
            <label><input type="checkbox" value="ì§€ì—­ ì œí•œì—†ìŒ" @change="updateFilters('ê·¼ë¬´ì§€ì—­', 'ì§€ì—­ ì œí•œì—†ìŒ')" /> ì§€ì—­ ì œí•œì—†ìŒ</label>
            <label><input type="checkbox" value="ì„œìš¸" @change="updateFilters('ê·¼ë¬´ì§€ì—­', 'ì„œìš¸')" /> ì„œìš¸</label>
            <label><input type="checkbox" value="ë¶€ì‚°" @change="updateFilters('ê·¼ë¬´ì§€ì—­', 'ë¶€ì‚°')" /> ë¶€ì‚°</label>
            <label><input type="checkbox" value="ëŒ€êµ¬" @change="updateFilters('ê·¼ë¬´ì§€ì—­', 'ëŒ€êµ¬')" /> ëŒ€êµ¬</label>
            <label><input type="checkbox" value="ì¸ì²œ" @change="updateFilters('ê·¼ë¬´ì§€ì—­', 'ì¸ì²œ')" /> ì¸ì²œ</label>
            <label><input type="checkbox" value="ê´‘ì£¼" @change="updateFilters('ê·¼ë¬´ì§€ì—­', 'ê´‘ì£¼')" /> ê´‘ì£¼</label>
          </div>
        </div>
        <div class="search-container">
          <!-- <input type="text" id="search-input" placeholder="ê³µê³ ëª…, ê¸°ì—…, ì§ë¬´, í‚¤ì›Œë“œ ê²€ìƒ‰" />
          <button id="search-btn">ê²€ìƒ‰</button> -->
          <input ref="searchInput" type="text" v-model="searchKeyword" placeholder="ê³µê³ ëª…, ëª¨ì§‘ë¶„ì•¼ í‚¤ì›Œë“œ *í† ê¸€ì´ˆê¸°í™”*"
            @keyup.enter="handleSearch" class="search-input" />
          <button @click="handleSearch" class="search-btn">ê²€ìƒ‰</button>
        </div>
      </div>

      <!-- ì„ íƒëœ í•„í„°ë“¤ -->
      <div class="selected-filters">
        <div id="selected-filters-list">
          <span v-for="filter in selectedFilters" :key="filter.name + filter.value" @click="removeFilter(filter)">
            {{ filter.name }}: {{ filter.value }} âœ•
          </span>
        </div>
        <a href="#" id="reset-filters" class="reset-filters" @click.prevent="resetFilters">ì´ˆê¸°í™”ğŸ”„ï¸</a>
      </div>

      <!-- ê²€ìƒ‰ ê²°ê³¼ -->
      <div class="results-header">
        <span>ê²€ìƒ‰ ê²°ê³¼ {{ announcementCount }}ê±´</span>
        <span class="sort-by">ìµœì‹ ìˆœ â–¼</span>
      </div>

      <table class="job-listing">
        <thead>
          <tr>
            <th>ë²ˆí˜¸</th>
            <th>ê¸°ì—…ëª…</th>
            <th>ê³µê³ ëª…</th>
            <th>ëª¨ì§‘ë¶„ì•¼</th>
            <th>ì±„ìš©í˜•íƒœ</th>
            <th>ê·¼ë¬´ì§€ì—­</th>
            <th>ë§ˆê°ì¼</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(announcement, index) in announcementStore.announcements2" :key="announcement.announcementIdx"
            @click="goToDetailPage(announcement.announcementIdx)" class="hoverable-row">
            <td>{{ index + 1 }}</td>
            <td>{{ announcement.companyName }}</td>
            <td>{{ announcement.announcementTitle }}</td>
            <td>{{ announcement.jobTitle }}</td>
            <td>{{ announcement.careerBase }}</td>
            <td>{{ announcement.region }}</td>
            <td>~ {{ announcement.announcementEnd }}</td>
          </tr>
        </tbody>
      </table>
    </section>
    <SeekerFooterComponent></SeekerFooterComponent>
  </div>
</template>

<script setup>
import SeekerHeaderComponent from "@/components/seeker/SeekerHeaderComponent.vue";
import SeekerFooterComponent from "@/components/seeker/SeekerFooterComponent.vue";
import { useRouter } from 'vue-router';
import { ref, onMounted, computed, watch } from 'vue';
import { UseAnnouncementStore } from "@/stores/UseAnnouncementStore";

const router = useRouter();
const announcementStore = UseAnnouncementStore();

// announcements2 ë¦¬ìŠ¤íŠ¸ì˜ ê¸¸ì´ = ê³µê³  ìˆ˜ë¥¼ ê³„ì‚°
const announcementCount = computed(() => announcementStore.announcements2.length);

// ê²€ìƒ‰ í‚¤ì›Œë“œì™€ ì„ íƒëœ í•„í„° ì €ì¥
const searchKeyword = ref('');
const selectedFilters = ref([]);

// ë“œë¡­ë‹¤ìš´ ìƒíƒœ ì €ì¥
const dropdownOpen = ref({
  'ê¸°ì—…í˜•íƒœ': false,
  'ì±„ìš©í˜•íƒœ': false,
  'ëª¨ì§‘ì§ë¬´': false,
  'ê·¼ë¬´ì§€ì—­': false
  // ë‹¤ë¥¸ í•„í„° í•­ëª©ë“¤ ì¶”ê°€ ê°€ëŠ¥
});

// ë“œë¡­ë‹¤ìš´ ì—´ê¸°/ë‹«ê¸° í† ê¸€ í•¨ìˆ˜
const toggleDropdown = (filterName) => {
  dropdownOpen.value[filterName] = !dropdownOpen.value[filterName];
};

// í•„í„° ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ë“œë¡­ë‹¤ìš´ ì´ë¦„ê³¼ í•„í„° ê°’ í•¨ê»˜ ì €ì¥)
const updateFilters = (filterName, filterValue) => {
  const exists = selectedFilters.value.find(f => f.name === filterName && f.value === filterValue);

  if (!exists) {
    selectedFilters.value.push({ name: filterName, value: filterValue });
  } else {
    selectedFilters.value = selectedFilters.value.filter(f => !(f.name === filterName && f.value === filterValue));
  }
};

// // í•„í„° ì œê±° í•¨ìˆ˜
// const removeFilter = (filter) => {
//   selectedFilters.value = selectedFilters.value.filter(f => f !== filter);
// };

// í•„í„° ì œê±° í•¨ìˆ˜
const removeFilter = (filter) => {
  selectedFilters.value = selectedFilters.value.filter(item => !(item.name === filter.name && item.value === filter.value));
};

// í•„í„° ì´ˆê¸°í™” í•¨ìˆ˜
const resetFilters = () => {
  selectedFilters.value = [];
};


// ê²€ìƒ‰ ë˜ëŠ” í•„í„°ë§ ì²˜ë¦¬
const handleSearch = () => {
  if (searchKeyword.value) {
    announcementStore.searchAnnouncements(searchKeyword.value);
  } else if (selectedFilters.value.length > 0) {
    announcementStore.filterAnnouncementsByFilters(selectedFilters.value);
  } else {
    console.error("ê²€ìƒ‰ì–´ ë˜ëŠ” í•„í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
  }
};

// watchë¡œ ì„ íƒëœ í•„í„°ê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œ ìë™ìœ¼ë¡œ ë°±ì—”ë“œì— ìš”ì²­
watch(selectedFilters, (newFilters) => {
  if (!searchKeyword.value && newFilters.length) {
    handleSearch();
  }
});


// // ê³µê³  ê²€ìƒ‰ ì²˜ë¦¬ í•¨ìˆ˜
// const handleSearch = () => {
//   if (searchKeyword.value) {
//     announcementStore.searchAnnouncements(searchKeyword.value);
//   } else {
//     console.error("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
//   }
// };


// í•„í„° ë“œë¡­ë‹¤ìš´ ë° ì„ íƒí•œ í•„í„° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
// const initializeFilters = () => {
//   const filterItems = document.querySelectorAll(".filter-item");
//   filterItems.forEach((item) => {
//     item.addEventListener("click", function () {
//       const filterName = this.getAttribute("data-filter");
//       const dropdown = document.getElementById(filterName);

//       // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ì´ ì—´ë ¤ ìˆìœ¼ë©´ ë‹«ê¸°
//       document.querySelectorAll(".filter-dropdown").forEach((drop) => {
//         if (drop !== dropdown) {
//           drop.style.display = "none";
//         }
//       });

//       // í´ë¦­í•œ ë“œë¡­ë‹¤ìš´ì„ í† ê¸€
//       if (dropdown.style.display === "block") {
//         dropdown.style.display = "none";
//       } else {
//         dropdown.style.display = "block";
//       }
//     });
//   });

//   // ê° ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
//   const checkboxes = document.querySelectorAll('.filter-dropdown input[type="checkbox"]');
//   checkboxes.forEach((checkbox) => {
//     checkbox.addEventListener("change", function () {
//       const filterValue = this.value;

//       if (this.checked) {
//         // ì²´í¬ëœ ê²½ìš° ë°°ì—´ì— ì¶”ê°€
//         selectedFilters.value.push(filterValue);
//       } else {
//         // ì²´í¬ í•´ì œëœ ê²½ìš° ë°°ì—´ì—ì„œ ì œê±°
//         selectedFilters.value = selectedFilters.value.filter((item) => item !== filterValue);
//       }

//       updateSelectedFilters();
//     });
//   });
// };

// ì„ íƒëœ í•„í„° í•­ëª©ì„ í™”ë©´ì— í‘œì‹œ
// const updateSelectedFilters = () => {
//   const selectedList = document.getElementById("selected-filters-list");
//   selectedList.innerHTML = "";

//   selectedFilters.value.forEach((filter) => {
//     const filterSpan = document.createElement("span");
//     filterSpan.textContent = filter + " âœ•";
//     filterSpan.style.cursor = "pointer";

//     // í•„í„° í•­ëª©ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ í•­ëª© í•´ì œ
//     filterSpan.addEventListener("click", () => {
//       selectedFilters.value = selectedFilters.value.filter((item) => item !== filter);
//       updateSelectedFilters();
//       document.querySelector(`.filter-dropdown input[value="${filter}"]`).checked = false;
//     });

//     selectedList.appendChild(filterSpan);
//   });
// };

// ì´ˆê¸°í™” ë²„íŠ¼
// const resetFilters = () => {
//   selectedFilters.value = [];
//   updateSelectedFilters();

//   // ëª¨ë“  ì²´í¬ë°•ìŠ¤ í•´ì œ
//   document.querySelectorAll('.filter-dropdown input[type="checkbox"]').forEach((checkbox) => {
//     checkbox.checked = false;
//   });
// };

// ê²€ìƒ‰ ë²„íŠ¼ ë™ì‘
// const handleSearch = () => {
//   const searchText = document.getElementById("search-input").value.toLowerCase();
//   if (searchText) {
//     alert("ê²€ìƒ‰ ê¸°ëŠ¥ ì‹¤í–‰: " + searchText);
//   } else {
//     alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
//   }
// };




// ê³µê³  ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
const goToDetailPage = (announcementIdx) => {
  router.push(`/seeker/announce/detail/${announcementIdx}`);
};

// ì»´í¬ë„ŒíŠ¸ê°€ ë¡œë“œë  ë•Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
onMounted(() => {
  // initializeFilters();

  // if (searchInput.value) {
  //   searchInput.value.addEventListener('keyup', handleSearchInput);  // DOM ìš”ì†Œê°€ ì¡´ì¬í•  ë•Œë§Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
  // } else {
  //   console.error('Search input element is not found');
  // }

  // // ì´ˆê¸°í™” ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
  // document.getElementById("reset-filters").addEventListener("click", resetFilters);

  // // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
  // document.getElementById("search-btn").addEventListener("click", handleSearch);

  // ì „ì²´ ê³µê³  ì¡°íšŒ í•¨ìˆ˜
  announcementStore.readAll();
});

</script>

<style scoped>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;

}

.body-arp {
  font-family: Arial, sans-serif;
  line-height: 1.6;
  background-color: #F9FAFB;
  justify-content: center;
  align-items: center;
  height: 100%;
  margin: 0 auto;
  padding: 0;
}

.search-container {
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 20px;
}

.search-input {
  width: 300px;
  padding: 10px;
  border-radius: 25px;
  border: 1px solid #ccc;
  outline: none;
  font-size: 16px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.search-input:focus {
  border-color: #212b36;
  box-shadow: 0 6px 10px rgba(0, 123, 255, 0.2);
}

.search-btn {
  padding: 10px 20px;
  margin-left: 10px;
  border: none;
  border-radius: 25px;
  background-color: #212b36;
  color: white;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.search-btn:hover {
  background-color: #0056b3;
  box-shadow: 0 6px 12px rgba(0, 123, 255, 0.3);
}

.search-btn:focus {
  outline: none;
}

.main-content {
  max-width: 1200px;
  margin: 60px auto;
  background-color: #fff;
  padding: 50px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.main-container> :last-child {
  justify-content: right;
}

h2 {
  font-size: 22px;
  margin-bottom: 20px;
  color: #333;
}

.filter-section {
  display: flex;
  justify-content: left;
  margin-bottom: 20px;
}

.filter-item {
  position: relative;
}

.dropdown-btn {
  padding: 8px 15px;
  width: 130px;
  border: 1px solid #ffffff;
  background-color: #cbdaea;
  cursor: pointer;
  font-size: 14px;
}

.filter-dropdown {
  /* display: none; */
  position: absolute;
  top: 40px;
  left: 0;
  background-color: #fff;
  border: 1px solid #ddd;
  padding: 10px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  z-index: 1;
  max-height: 200px;
  overflow-y: auto;
}

.filter-dropdown label {
  display: block;
  margin-bottom: 5px;
  font-size: 14px;
}

.selected-filters {
  margin-bottom: 20px;
}

.selected-filters span {
  background-color: #e0e0e0;
  padding: 5px 10px;
  margin-right: 10px;
  border-radius: 20px;
  display: inline-block;
  font-size: 14px;
  color: #333;
  cursor: pointer;
}

.reset-filters {
  color: #212b36;
  text-decoration: none;
  font-size: 14px;
}

.results-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 15px;
}

.sort-by {
  cursor: pointer;
  color: #666;
}

.job-listing {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.job-listing th,
.job-listing td {
  padding: 12px;
  border-bottom: 1px solid #ddd;
  text-align: left;
}

.job-listing th {
  background-color: #f9f9f9;
}

.job-listing tr:hover {
  background-color: #f1f1f1;
}

.job-listing td:last-child {
  text-align: center;
}

.search-container {
  display: flex;
  align-items: center;
  margin-left: 20px;
}

#search-input {
  padding: 8px;
  width: 300px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

#search-btn {
  margin-left: 10px;
  padding: 8px 15px;
  background-color: #212b36;
  color: white;
  border: none;
  cursor: pointer;
  border-radius: 4px;
}

#search-btn:hover {
  background-color: #212b36;
}

/* ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
.dropdown-menu {
  display: none;
  /* ì²˜ìŒì—ëŠ” ìˆ¨ê¹€ */
  position: absolute;
  background-color: white;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
  padding: 10px;
  border-radius: 5px;
  z-index: 100;
  width: 120px;
  top: 100%;
  /* í´ë¦­í•œ ìš”ì†Œ ì•„ë˜ì— ìœ„ì¹˜ */
  right: 0;
  /* ì˜¤ë¥¸ìª½ì— ë§ì¶° ì •ë ¬ */
}

.logout-btn {
  display: block;
  /* padding: 4px 16px; */
  margin: 0 0 0 0;
  text-decoration: none;
  color: #333;
  text-align: center;
  border-radius: 4px;
  /* background-color: #83a5ea; */
  color: white;
}

.logout-btn:hover {
  /* background-color: #83a5ea; */
}


/* í…Œì´ë¸” í–‰ hover ì‹œ ìƒ‰ê¹” ë³€í™” */
.hoverable-row {
  transition: background-color 0.3s ease;
}

.hoverable-row:hover {
  background-color: #f6f6f6;
  /* ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ ì•½ê°„ ì–´ë‘¡ê²Œ ë³€ê²½ */
  cursor: pointer;
}
</style>
